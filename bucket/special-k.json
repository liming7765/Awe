{
    "version": "25.11.17.1",
    "description": "Special K - The Swiss Army Knife of PC gaming (SKIF)",
    "homepage": "https://www.special-k.info/",
    "license": "GPL-3.0",
    "url": "https://sk-data.special-k.info/repository/SpecialK_25.11.17.1.exe",
    "hash": "ad131b0481482a7c7dca749ebc18b0e23633959018319df07de964ffa910e606",
    "innosetup": true,
    "architecture": {
        "64bit": {
            "bin": "SKIF.exe",
            "shortcuts": [
                [
                    "SKIF.exe",
                    "Special K"
                ],
                [
                    "SKIV.exe",
                    "Special K Image Viewer"
                ]
            ]
        }
    },
    "installer": {
        "script": [
            "# 1. 将 {app} 文件夹里的所有内容移动到根目录",
            "Get-ChildItem \"$dir\\{app}\\*\" | Move-Item -Destination \"$dir\" -Force",
            "",
            "# 2. 清理 InnoSetup 产生的垃圾文件夹和脚本",
            "Remove-Item \"$dir\\{app}\", \"$dir\\{tmp}\", \"$dir\\*.iss\" -Recurse -Force -ErrorAction SilentlyContinue",
            "",
            "# 3. 处理怪异的文件名：SKIF,1.exe 是最新的，将其重命名为 SKIF.exe",
            "if (Test-Path \"$dir\\SKIF,1.exe\") {",
            "    Rename-Item \"$dir\\SKIF,1.exe\" \"SKIF.exe\" -Force",
            "}",
            ""
        ]
    },
    "persist": [
        "Global",
        "Profiles",
        "Logs"
    ],
    "pre_uninstall": [
        "if (Get-Process -Name 'SKIF' -ErrorAction SilentlyContinue) { Stop-Process -Name 'SKIF' -Force }",
        "Remove-Item 'HKCU:\\SOFTWARE\\Kaldaien\\Special K' -Recurse -Force -ErrorAction SilentlyContinue"
    ],
    "checkver": {
        "script": [
            "$jsonContent = Invoke-RestMethod 'https://sk-data.special-k.info/repository.json'",
            "$version = $jsonContent.Main.Versions.Where({$_.Branches -eq 'Website'}).Name[0]",
            "Write-Output $version"
        ],
        "regex": "([\\d.]+)"
    },
    "autoupdate": {
        "url": "https://sk-data.special-k.info/repository/SpecialK_$version.exe",
        "hash": {
            "url": "https://sk-data.special-k.info/repository.json",
            "jsonpath": "$.Main.Versions[?(@.Name == '$version')].SHA256"
        }
    }
}
