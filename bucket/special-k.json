{
    "version": "25.12.1",
    "description": "Special K - The Swiss Army Knife of PC gaming (SKIF)",
    "homepage": "https://www.special-k.info/",
    "license": "GPL-3.0",
    "url": "https://sk-data.special-k.info/repository/SpecialK_25.12.1.exe",
    "hash": "5871199079801a59af295984ed62d3db6e8f436eeaa48e686a4d5aadce0db7ea",
    "innosetup": true,
    "architecture": {
        "64bit": {
            "bin": "SKIF.exe",
            "shortcuts": [
                [
                    "SKIF.exe",
                    "Special K"
                ],
                [
                    "SKIV.exe",
                    "Special K Image Viewer"
                ]
            ]
        }
    },
    "installer": {
        "script": [
            "# 1. 检查是否存在 {app} 文件夹，如果存在才移动文件",
            "if (Test-Path \"$dir\\{app}\") {",
            "    Get-ChildItem \"$dir\\{app}\\*\" | Move-Item -Destination \"$dir\" -Force",
            "    Remove-Item \"$dir\\{app}\" -Recurse -Force -ErrorAction SilentlyContinue",
            "}",
            "",
            "# 2. 清理垃圾文件（如果有）",
            "Remove-Item \"$dir\\{tmp}\", \"$dir\\*.iss\" -Recurse -Force -ErrorAction SilentlyContinue",
            "",
            "# 3. 重命名主程序 (SKIF,1.exe -> SKIF.exe)",
            "if (Test-Path \"$dir\\SKIF,1.exe\") {",
            "    Rename-Item \"$dir\\SKIF,1.exe\" \"SKIF.exe\" -Force",
            "}",
            ""
        ]
    },
    "persist": [
        "Global",
        "Profiles",
        "Logs"
    ],
    "pre_uninstall": [
        "if (Get-Process -Name 'SKIF' -ErrorAction SilentlyContinue) { Stop-Process -Name 'SKIF' -Force }",
        "Remove-Item 'HKCU:\\SOFTWARE\\Kaldaien\\Special K' -Recurse -Force -ErrorAction SilentlyContinue"
    ],
    "checkver": {
        "script": [
            "$jsonContent = Invoke-RestMethod 'https://sk-data.special-k.info/repository.json'",
            "$version = $jsonContent.Main.Versions.Where({$_.Branches -eq 'Website'}).Name[0]",
            "Write-Output $version"
        ],
        "regex": "([\\d.]+)"
    },
    "autoupdate": {
        "url": "https://sk-data.special-k.info/repository/SpecialK_$version.exe",
        "hash": {
            "url": "https://sk-data.special-k.info/repository.json",
            "jsonpath": "$.Main.Versions[?(@.Name == '$version')].SHA256"
        }
    }
}
